; SPDX-FileCopyrightText: 2024 Tobias Schwarz <tobias.schwarz@tum.de>
;
; SPDX-License-Identifier: LicenseRef-Proprietary

; RUN: rm -rf %t
; RUN: mkdir %t

; RUN: %tpde_test %s --no-fixed-assignments -o %t/out.o
; RUN: objdump -Mintel-syntax --no-addresses --no-show-raw-insn --disassemble %t/out.o | FileCheck %s -check-prefixes=X64,CHECK --enable-var-scope --dump-input always

; CHECK-LABEL: sub1
sub1(%a, %b) {
entry:
; X64: sub rsp
; X64-NEXT: sub rdi,rsi
  %res = sub %a, %b
; X64-NEXT: mov rax,rdi
; X64-NEXT: add rsp
  ret %res
}

; CHECK-LABEL: sub2
sub2(%a, %b) {
entry:
; X64: sub rsp
; X64-NEXT: mov [[REG:r.*]],rdi
; X64-NEXT: sub [[REG]],rsi
  %tmp = sub %a, %b
; X64-NEXT: sub rdi,[[REG]]
  %res = sub %a, %tmp
; X64-NEXT: mov rax,rdi
; X64-NEXT: add rsp
  ret %res
}
